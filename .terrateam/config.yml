# Terrateam Configuration
# R2 Backend with explicit directory targeting
version: "1"

when_modified:
  file_patterns:
    - "terraform/**/*.tf"
    - "terraform/**/*.tfvars"
    - ".terrateam/config.yml"
  autoplan: true

# Only run Terraform in the terraform/ directory
dirs:
  terraform:
    tags:
      - infra
    when_modified:
      file_patterns:
        - "**/*.tf"
        - "**/*.tfvars"

# Workflow with R2 backend configuration
workflows:
  - tag_query: "infra"
    plan:
      - type: init
        extra_args:
          - "-backend-config=bucket=$R2_BUCKET"
          - "-backend-config=endpoints={s3=\"https://$R2_ACCOUNT_ID.r2.cloudflarestorage.com\"}"
      - type: plan
    apply:
      - type: init
        extra_args:
          - "-backend-config=bucket=$R2_BUCKET"
          - "-backend-config=endpoints={s3=\"https://$R2_ACCOUNT_ID.r2.cloudflarestorage.com\"}"
      - type: apply

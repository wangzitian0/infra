# Terrateam Configuration
# Replaces manual GitHub Actions for Terraform Plan/Apply
# Provides: PR-based workflow, locking, plan consistency

version: 1

when_modified:
  file_patterns:
    - "terraform/**/*.tf"
    - "terraform/**/*.tfvars"
    - ".terrateam/config.yml"
  autoplan: true

workflows:
  default:
    plan:
      - type: init
        extra_args:
          - "-backend-config=bucket=${{ env.R2_BUCKET }}"
          - "-backend-config=endpoints={s3=\"https://${{ env.R2_ACCOUNT_ID }}.r2.cloudflarestorage.com\"}"
      - type: plan
    apply:
      - type: init
        extra_args:
          - "-backend-config=bucket=${{ env.R2_BUCKET }}"
          - "-backend-config=endpoints={s3=\"https://${{ env.R2_ACCOUNT_ID }}.r2.cloudflarestorage.com\"}"
      - type: apply


dirs:
  terraform:
    workflow: default


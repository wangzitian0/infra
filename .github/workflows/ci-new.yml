name: CI Pipeline New

on:
  pull_request:
    branches: [main]
  issue_comment:
    types: [created]

env:
  PYTHON_VERSION: '3.11'

jobs:
  # ================================================================
  # Step 1: Basic check
  # ================================================================
  check:
    name: Check (fmt + validate)
    if: |
      github.event_name == 'pull_request' ||
      (github.event_name == 'issue_comment' && 
       github.event.issue.pull_request &&
       contains(github.event.comment.body, '/check'))
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.10.3
          terraform_wrapper: false
      
      - name: Terraform Format Check
        run: terraform fmt -check -recursive
      
      - run: echo "âœ… Check job completed"
  
  # ================================================================
  # Step 2: Help command
  # ================================================================
  help:
    name: Help
    if: |
      github.event_name == 'issue_comment' && 
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '/help')
    runs-on: ubuntu-latest
    steps:
      - name: Show Help
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr comment ${{ github.event.issue.number }} --body "
          ## ðŸ“– CI Pipeline New - Available Commands
          
          | Command | Description | Status |
          |---------|-------------|--------|
          | \`/check\` | Format & Validate | âœ… Working |
          | \`/help\` | Show this message | âœ… Working |
          
          **Next steps**: Bootstrap jobs, Digger integration
          "

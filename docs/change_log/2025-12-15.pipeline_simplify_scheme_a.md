# 2025-12-15: Pipeline Simplification (Scheme A)

## Summary
Simplified PR workflow to Scheme A: CI only runs static checks; Atlantis is the single executor for plan/apply (autoplan on PR updates). Kept infra-flash per-commit audit comments and made plan/apply attribution robust via an explicit commit marker in Atlantis output.

## Changes

### CI (Static Checks Only)
- `.github/workflows/terraform-plan.yml`: Removed environment/SSH/Vault setup; runs `fmt/tflint/validate` (with `terraform init -backend=false`) and posts one infra-flash comment per commit (L1-L4).
- `tools/preflight-check.sh`: Updated helm repo URL scan to match current layer directories.

### Atlantis (Single Source of Plan/Apply)
- `atlantis.yaml`: Injects `infra-flash-commit:xxxxxxx` into plan/apply output for deterministic mapping back to the infra-flash commit comment.
- `.github/workflows/infra-flash-update.yml`: Uses the commit marker from Atlantis output to append Plan/Apply status to the matching infra-flash per-commit comment.

### Bootstrap Workflow Hygiene
- `.github/workflows/deploy-k3s.yml`: Trimmed to L1 Bootstrap apply only (k3s + Atlantis). L2+ remains handled via Atlantis.

### Docs
- `docs/ssot/pipeline.md`, `docs/ssot/README.md`, `.github/workflows/README.md`, `.github/README.md`, `README.md`: Updated to match the simplified Scheme A workflow and commit-marker based mapping.

## Why
- **Less confusion**: one place to look for real plan/apply (Atlantis), one place for syntax checks (CI).
- **Better audit**: per-commit infra-flash comments remain, with reliable plan/apply attribution even with concurrent PR updates.
- **Less redundant automation**: bootstrap workflow no longer overlaps L2+ responsibilities.

## Verification
- Open a test PR, push 2 commits, confirm 2 infra-flash comments are created.
- Confirm Atlantis autoplan appends `Plan` to the correct commit comment (marker-based match).
- Run `atlantis apply` after review and confirm it appends `Apply` and indicates ready-to-merge.

# 2025-12-09: Storage Retain for Data Persistence

## Summary
Implemented `local-path-retain` StorageClass to prevent accidental data loss when PVCs are deleted.

## Changes

### L1 (1.nodep)
- `4.storage.tf`: New file
  - Patch `local-path-config` ConfigMap to use `/data/local-path-provisioner`
  - Add `local-path-retain` StorageClass with `ReclaimPolicy=Retain`
  - Auto-restart provisioner on config changes

### L2 (2.platform)
- `1.postgres.tf`: Changed Postgres StorageClass from `local-path` to `local-path-retain`

## Why
- Previous PVC deletions wiped data permanently
- Need persistent storage that survives service reinstalls
- Data should only be deleted manually

## Verification
```bash
# Check StorageClass exists
kubectl get storageclass local-path-retain

# Verify config path
kubectl get configmap local-path-config -n kube-system -o jsonpath='{.data.config\.json}'

# Test: delete PVC, verify PV remains
kubectl delete pvc <test-pvc>
kubectl get pv  # Should show Released status
```

## Notes
- `/data` directory must exist on VPS before apply
- Released PVs require manual cleanup: `kubectl delete pv <pv-name>`
- First apply may require: `terraform import kubernetes_config_map_v1.local_path_config kube-system/local-path-config`

# 2025-12-04 — k3s 安装 Infisical（BRN-004）

## 做了什么
- 在 Terraform 中增加 Infisical Helm 安装（chart 0.4.2，image 1.17.0），默认 namespace 调整为 `iac`（供 Cloudflare/Infisical/Kubero 共用），副本降为 1，关闭 Ingress。
- 通过 random_* 生成加密/JWT/Mongo 密钥和 Mailhog SMTP 配置，写入 Helm values 模板并经 SSH 安装，安装完自动清理临时 values 文件。
- tfvars 模板新增 Infisical 相关变量，README 增补访问方式（端口转发）与默认组件说明。

## 如何验证
1. 按 README 更新 `terraform/terraform.tfvars`（含 Infisical 变量），并准备 R2/backend 配置。
2. `cd terraform && terraform fmt && terraform init ... && terraform plan`；若可部署，执行 `terraform apply`。
3. 设置 KUBECONFIG 后 `kubectl -n iac get pods`，确认 Pods 就绪，再 `kubectl -n iac port-forward svc/infisical-backend 8080:8080` 浏览器访问 http://localhost:8080。

## 后续建议
- 根据实际域名配置 `infisical_site_url`，准备正式 SMTP（替换内置 Mailhog）与 Ingress/证书。
- 评估 Mongo 持久化容量与备份策略，必要时接入托管 Mongo。

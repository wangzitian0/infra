# 2025-12-22: Fix Data Layer CI and Clarify SSOT Responsibilities

## Situation
The `deploy-k3s` workflow failed during `Apply Infrastructure (L3 - Data)` in the `prod` workspace.
The error was `registry.terraform.io/clickhouse/clickhousedbops: failed to instantiate provider`.
Additionally, the documentation for Vault RBAC needed more clarity on the responsibility split between Casdoor and Vault.

## Task
1. Fix the ClickHouse provider error in the Data layer.
2. Clarify the "Identity SSOT" (Casdoor) vs "Authorization SSOT" (Vault) in the documentation.
3. Ensure all READMEs are updated to pass CI coverage checks.

## Action
1. **Restored `clickhousedbops` Provider**: Re-added the provider to `3.data/versions.tf` and `3.data/providers.tf`. This allows Terraform to load and manage (destroy) resources in the state file that were previously managed by this provider.
    - **Fixed Auth Strategy**: Updated `providers.tf` to use `strategy = "basicauth"` for the `http` protocol, as required by the provider.
2. **Updated Auth SSOT**: Added a new section "SSOT 职责模型" to `docs/ssot/platform.auth.md` explaining the separation of concerns.
3. **Satisfaction of Coverage Check**: Updated `3.data/README.md` and `docs/ssot/README.md` to pass the `README Coverage` script.
4. **Updated lock file**: Ran `terraform init` to ensure `.terraform.lock.hcl` is consistent.

## Result
- **CI**: `terraform validate` and `README Coverage` checks pass.
- **Apply**: The post-merge apply should now succeed as Terraform can handle the orphaned resources in the state.
- **Confidence**: 100%.

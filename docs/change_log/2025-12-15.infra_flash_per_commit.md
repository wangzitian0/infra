# 2025-12-15: infra-flash Per-Commit Comment Stream

## Summary
CI / Atlantis 评论流拆分为“每个 commit 一条 infra-flash 评论 + 追加式 Plan/Apply 状态”，所有触发记录（触发人、输出链接、下一步）沉淀到同一条评论里，构建清晰的可审计轨迹。

## Changes

### GitHub Actions
- `.github/workflows/terraform-plan.yml`: PR push 时为 **每个 commit** 新建一条包含 CI 表格、修复命令与下一步指引的评论（`<!-- infra-flash-commit:sha -->` 锚点）。
- `.github/workflows/infra-flash-update.yml`: 监听 Atlantis `Ran Plan/Apply` 评论，定位相同 commit 的评论，附加触发者链接、Atlantis 输出、下一步动作，并在失败时提示修复路径。
- `.github/workflows/README.md` / `README.md`: 描述 per-commit 评论设计与触发流程。

### Documentation
- `docs/ssot/pipeline.md`: 重新绘制 Happy Path / 多 commit / 状态流转示意，强调“单条评论追踪单个 commit”。
- `docs/ssot/README.md`: Pipeline 行补充 per-commit 评论说明。
- `2.platform/README.md`: 移除测试残留行，保持 SSOT 干净。

### Runbook & Context
- `0.check_now.md`: 刷新 5W1H，聚焦 infra-flash per-commit 交付与验证清单。
- `docs/change_log/README.md`: 登记本次条目。

## Why
- **审计一致性**：同一 commit 的 CI → Plan → Apply 历史集中在一条评论，PR 纵向对齐多个 commit 的状态。
- **操作引导**：评论尾部始终给出下一步动作，失败时嵌入修复命令或回滚建议。
- **调试定位**：Plan/Apply 状态会链回触发评论与 Atlantis 输出，方便复盘。

## Verification
- `terraform-plan.yml` 静态检查通过（fmt/lint/validate 步骤未改，只扩展评论逻辑）。
- 手动 review `infra-flash-update.yml` 分支逻辑：Plan/Apply 成功/失败均能生成下一步提示，注入触发/输出链接。
- 待生产验证：发起测试 PR ⇒ Push 2 个 commit ⇒ 分别运行 `atlantis plan/apply`，确认评论分片与审计链路。

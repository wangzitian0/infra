# 2025-12-24: Data DB Operators for Redis and ClickHouse

## Situation

The Data layer still used Helm charts for Redis and ClickHouse while PostgreSQL (CNPG) and ArangoDB were already operator-managed. This created an inconsistent control plane for stateful services and made it harder to standardize lifecycle handling.

## Task

1. Replace Redis and ClickHouse Helm releases with operator-managed CRs.
2. Preserve existing Vault/VSO secret flow and service DNS names for L4 apps.
3. Update Data layer docs to reflect the operator flow.

## Action

### 1. Redis → Opstree Redis Operator

- Installed `redis-operator` and created a standalone `Redis` CR that reads `redis-credentials` from VSO.
- Kept service name `redis-master` to avoid changing app connection strings.

### 2. ClickHouse → Altinity Operator

- Installed `altinity-clickhouse-operator` and created a `ClickHouseInstallation` CR.
- Configured default user password from `random_password` and preserved the `clickhouse` service DNS.
- Set PVC template to `local-path-retain` for data persistence.

### 3. Dependencies and Outputs

- Updated health outputs, OpenPanel deps, and ClickHouse user provisioning to follow operator readiness.

### 4. Documentation

- Adjusted Data layer README wording from Helm to operator flow.

## Result

- Redis and ClickHouse are now operator-managed in the Data layer.
- Vault/VSO secret flow and service addresses remain unchanged for L4 apps.
- Confidence: 80% (not applied in-cluster).

## Provider Priority Note

- Redis uses the Opstree community operator because there is no official open-source standalone Redis operator; documented here per SOP.

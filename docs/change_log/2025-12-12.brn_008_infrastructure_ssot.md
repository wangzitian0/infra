# 2025-12-12: BRN-008 P0 Infrastructure & SSOT Docs

## Summary
Implemented critical P0 infrastructure tasks and documentation restructuring for [BRN-008](../project/BRN-008.md). This includes deploying Platform PostgreSQL in L1, enabling Vault audit logs, hardening Atlantis security, and establishing the SSOT documentation directory structure.

## Changes

### L1 Infrastructure (PR #120, #122, #124)
- **Platform PostgreSQL**: Deployed Bitnami PostgreSQL Helm chart in `platform` namespace (managed by L1) as the Trust Anchor database.
  - Fix: Updated Chart version to `16.3.2` (PR #124).
  - Fix: Added `import` block logic to adopt existing platform namespace (PR #122).
- **Atlantis**: Added `whitelist-source-range` annotation to Ingress for GitHub Webhook IP restrictions.

### L2 Platform (PR #120)
- **Vault**: Enabled `auditStorage` with `local-path-retain` (1Gi) for compliance.
- **Refactoring**: Updated resource references to use `data.kubernetes_namespace.platform` since namespace is now managed by L1.

### Documentation (PR #121, #123)
- **SSOT Directory**: Created `docs/ssot/` and migrated core documentation files (`secrets.md`, `vars.md`, `pipeline.md`, `db.md`, `auth.md`, `network.md`).
- **K3s/Kubero**: Added missing SSOT documentation in `docs/ssot/k3s.md`.
- **Navigation**: Updated `docs/README.md` to point to the new structure.

## Why
- **Trust Anchor**: Platform PostgreSQL in L1 breaks circular dependencies for Vault and Casdoor.
- **Security**: Audit logging for Vault and IP whitelisting for Atlantis are mandatory P0 requirements.
- **Maintainability**: Centralized SSOT documentation (`docs/ssot/`) reduces ambiguity and improves onboarding.

## Verification
- **CI/CD**: `deploy-k3s` workflow passed for all L1/L2 changes.
- **Documentation**: Documentation Guard verified link integrity.

# 0.check_now.md

## 1. What (Target)
Per-commit comment system with full traceability, using Atlantis autoplan: CI creates skeleton comment; Atlantis runs autoplan; `infra-flash-update.yml` appends status to comment.

## 2. Why (Value)
- **Robustness**: CI creates skeleton comment immediately (locks commit SHA)
- **Traceability**: All actions (Autoplan/Human Plan/Apply) have clickable links to source
- **Simplicity**: Rely on Atlantis robust autoplan mechanism instead of custom triggers

## 3. Where (Location)
- Workflows: `.github/workflows/terraform-plan.yml`, `.github/workflows/infra-flash-update.yml`
- Docs: `.github/workflows/README.md`

## 4. Who (Owner)
Infra Platform / AI Assistant

## 5. When (Timeline)
Dec 17 - Implementing and verifying new flow (Scheme B -> Scheme C: Autoplan).

## 6. How (Action Plan)

### Implementation Steps
- [x] Restore `autoplan.enabled: true` in `atlantis.yaml`
- [x] Remove manual Atlantis trigger from `terraform-plan.yml`
- [x] Update `infra-flash-update.yml` to handle autoplan trigger linking to Atlantis comment itself
- [x] Update `.github/workflows/README.md` to reflect new flow

### Verification Checklist
- [ ] PR push â†’ CI skeleton comment created
- [ ] Atlantis starts autoplan (parallel)
- [ ] `infra-flash-update` detects Atlantis comment
- [ ] `infra-flash-update` finds skeleton comment (or retries/fails if skeleton slow - **Note**: Skeleton is fast, usually <10s)
- [ ] Plan status appended: `[@autoplan #id](atlantis-link)`
- [ ] Human apply: `[@user #id](comment-link)`

### Follow-ups
- Merge to main for `infra-flash-update.yml` logic to take effect

# 0.check_now.md

## 1. What (Target)
Stabilize infra-flash per-commit comment stream — ensure `infra-flash-update.yml` reliably triggers on `issue_comment` and appends Atlantis Plan/Apply to the correct commit comment.

## 2. Why (Value)
Provide auditors and engineers with an immediately scannable record: CI failures show fix commands, successful plan/apply append trigger/output links, and Ready-to-Merge signals are scoped per commit (no stale states after new pushes).

## 3. Where (Location)
- Automation: `.github/workflows/terraform-plan.yml`, `.github/workflows/infra-flash-update.yml`
- Docs: `.github/workflows/README.md`, `README.md`, `docs/ssot/pipeline.md`, `docs/ssot/README.md`
- Context & History: `0.check_now.md`, `docs/change_log/2025-12-15.infra_flash_per_commit.md`
- Cleanup: `2.platform/README.md`

## 4. Who (Owner)
Infra Platform / AI Assistant (acting CTO view for review simplicity & architecture fitness).

## 5. When (Timeline)
Dec 15 window → #182 merged. Next: fix updater trigger (workflow file issue) and re-run a smoke PR to confirm end-to-end append.

## 6. How (Action Plan)

### Implementation Steps
- [x] CI creates new infra-flash comment per commit with CI matrix + guidance.
- [x] Atlantis hook locates matching comment (via `<!-- infra-flash-commit:sha -->`), appends Plan/Apply blocks with trigger/output links and actionable next steps.
- [x] Refresh SSOT docs (pipeline + workflow README) & clean stray text in `2.platform/README`.
- [x] Record change log entry + update this 5W1H.

### Verification Checklist
- [ ] Create a smoke PR and push 2 commits ⇒ confirm two distinct infra-flash comments exist (each scoped to its SHA).
- [ ] Comment `atlantis plan -p platform` ⇒ verify `infra-flash-update.yml` runs and appends `### Atlantis Plan ...` to the matching commit comment.
- [ ] Comment `atlantis apply -p platform` (optional) ⇒ verify it appends `### Atlantis Apply ...` and shows `✅ Ready to merge!`.
- [ ] Observe Apply success ⇒ comment shows `✅ Ready to merge!` only on the current commit.
- [ ] Observe Plan/Apply failure ⇒ comment swaps in "Fix errors" guidance + removes stale next-step hints.

### Follow-ups / Notes
- Dogfood on an internal PR before exposing to contributors; capture screenshots for docs if reviewers need visual aids.
- If Atlantis latency causes head SHA drift, consider capturing SHA via trigger comment metadata as a future refinement.

# 0.check_now.md

## 1. What (Target)
BRN-008 P2: Casdoor Password 1Password SSOT Migration

## 2. Why (Value)
Migrate Casdoor admin password from Terraform random_password to 1Password SSOT, consistent with all other secrets.

## 3. Where (Location)
- L1 Bootstrap: `1.bootstrap/variables.tf`, `1.bootstrap/2.atlantis.tf` (add TF_VAR)
- L2 Platform: `2.platform/variables.tf`, `2.platform/5.casdoor.tf` (use var)
- Docs: `docs/ssot/secrets.md` (SSOT diagram)
- Docs: `docs/ssot/env.md`, `docs/ssot/vars.md`, `envs/README.md` (env/vars alignment for multi-env apps)

## 4. Who (Owner)
Infra Team / AI Assistant (Antigravity)

## 5. When (Timeline)
Current Phase: 1Password SSOT Migration

## 6. How (Action Plan)

### Blocking Actions
- [ ] **Create 1Password item**: `Casdoor Admin` with `password` field
- [ ] **Sync to GitHub Secret**: `gh secret set CASDOOR_ADMIN_PASSWORD ...`
- [ ] **Deploy L1**: Apply Atlantis config with new TF_VAR
- [ ] **Deploy L2**: Recreate Casdoor with password from 1Password

### Completed (PRs #125-150)
- [x] PR #150: init_data.json mount fix (root path with subPath)
- [x] Casdoor login verified with correct password
- [x] Replaced `random_password` with `var.casdoor_admin_password`
- [x] Added `casdoor_admin_password` variable to L1/L2
- [x] Added `TF_VAR_casdoor_admin_password` to Atlantis env
- [x] Updated secrets.md with 1Password SSOT diagram
- [x] Added Env SSOT: `docs/ssot/env.md` and aligned namespace/env semantics across SSOT + `envs/`
- [x] Fixed infra reproducibility/security bugs: Atlantis Traefik IPAllowList, removed PG image `latest`, made Kubero UI image configurable (avoid `latest` + `Always`)

### Prerequisites
- 1Password item: `Casdoor Admin` with `password` field (needs to be created)
- GitHub Secret: `CASDOOR_ADMIN_PASSWORD` (needs to be synced)

## Verification Checklist
- [ ] Casdoor pod running with password from 1Password
- [ ] Admin login works at https://sso.zitian.party
- [ ] Password matches 1Password value

---
*Last updated: 2025-12-13*

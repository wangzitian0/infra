# 0.check_now.md

## 1. What (Target)
Landing the Observability stack (L4), finalizing Vault Database secret injection, and **cleaning up infrastructure sprawl**.

## 2. Why (Value)
- **Observability**: SigNoz integration for platform-wide metrics and tracing.
- **Security**: Dynamic DB credentials and RBAC hardening.
- **Efficiency**: Eliminate resource redundancy and resolve certificate failures.

## 3. Where (Location)
- L1 Bootstrap: `1.bootstrap/2.atlantis.tf` (Ingress fixes)
- L2 Platform: `2.platform/6.vault-database.tf`
- L3 Data: `3.data/` (Redundancy cleanup)
- L4 Apps: `4.apps/` (Signoz & Kubero fixes)

## 4. Who (Owner)
Infra Platform / AI Assistant

## 5. When (Timeline)
Dec 19 - Ongoing.

## 6. How (Action Plan)

### Implementation Steps
- [ ] **Final Pipeline Validation**: Verify AI Review auto-write-back on main branch.
- [ ] **Infrastructure Cleanup**: Delete `data` and `data-default` namespaces and associated Helm releases.
- [ ] **Portal Gate Fix**: Ensure `portal-auth` and its Middleware are correctly deployed or decoupled from Ingress.
- [ ] **DNS-01 / Cert Fix**: Fix Cloudflare API permissions (Error 7003) for `wildcard-tls-internal`.
- [ ] **Slash Command Dispatcher**: Implement unified `/review`, `/dig`, `/help` command distribution via GitHub Actions and consolidate into `infra-flash` comment stream.
- [ ] **Atlantis Hardening**: Mount `atlantis-ipallowlist` middleware to the Atlantis Ingress.
- [ ] Finalize Vault PostgreSQL Database Engine configuration.
- [ ] Implement Vault Agent Sidecar injection for Redis/ClickHouse workloads in L3.
- [ ] Deploy SigNoz Helm chart in L4.

---

## DONE (History)
- [x] [2025-12-19: Pipeline V2 Upgrade (Dashboard SSOT & AI Review Auto-writeback)](./docs/ssot/ops.pipeline.md)
- [x] [2025-12-19: CI/CD Secret Chain Refactoring (DRY & Shift-Left)](./docs/change_log/2025-12-19.ci_secrets_refactor.md)

---

## 7. Findings (Current Backlog)

### ğŸ”´ å…³é”® (Critical)
- [ ] **èµ„æºè”“å»¶** â€“ é›†ç¾¤ä¸­å¹¶å­˜ data, data-default, data-staging, data-prod å¤šä¸ªé‡å¤å±‚çº§ï¼›postgresql åœ¨ 5 ä¸ªå‘½åç©ºé—´è¿è¡Œã€‚
- [ ] **Ingress å†²çª** â€“ `kcloud.zitian.party` åŒæ—¶è¢« kubero-prod å’Œ kubero-staging ä½¿ç”¨ï¼Œè·¯ç”±ä¸ç¡®å®šã€‚
- [ ] **è¯ä¹¦å¤±è´¥** â€“ `wildcard-tls-internal` ç­¾å‘æŠ¥ Error 7003 (Cloudflare Zone ID å‘ç°å¤±è´¥)ã€‚
- [ ] **ä¸­é—´ä»¶ç¼ºå¤±** â€“ kubero-staging å¼•ç”¨äº†ä¸å­˜åœ¨çš„ `portal-auth` ä¸­é—´ä»¶ï¼Œå¯¼è‡´ 404ã€‚

### ğŸŸ¡ ä¸¥é‡ (High)
- [ ] **å­˜å‚¨æ®‹ç•™** â€“ å¤§é‡ Released çŠ¶æ€çš„ PV (æ—§ security/platform å·) æœªå›æ”¶ã€‚
- [ ] **Atlantis ç­–ç•¥å¤±æ•ˆ** â€“ å®šä¹‰äº† `atlantis-ipallowlist` ä½†æœªæŒ‚è½½åˆ° Ingressï¼ŒWebhook IP é™åˆ¶æœªå¼€å¯ã€‚
- [ ] **æƒé™åˆè§„** â€“ `dashboard-admin` ä¾ç„¶ç›´æ¥ç»‘å®šåœ¨ `cluster-admin`ï¼Œæœªæœ€å°åŒ–ã€‚

### ğŸ”µ ä¸­ç­‰/ä½ (Medium/Low)
- [ ] **Casdoor å¥å£®æ€§** â€“ `2.platform/90.casdoor-apps.tf:74-75` ä¸å¯ç”¨æ—¶é™é»˜é€€å‡ºï¼Œåº”æ”¹ä¸ºæŠ¥é”™ã€‚
- [ ] **Scope æ ¡éªŒ** â€“ ç¡®è®¤ Casdoor æ˜¯å¦æ”¯æŒç¡¬ç¼–ç çš„ `openid profile email`ã€‚
- [ ] **æ–‡æ¡£ä¸ä¸€è‡´** â€“ `docs/ssot/db.redis.md` æè¿°çš„ Vault Agent æµç¨‹åœ¨ä»£ç ä¸­æœªä½“ç°ã€‚
- [ ] **Traefik å…¼å®¹æ€§** â€“ `platform.network.md` ä¸­ NGINX æ³¨è§£å¯¹ Traefik æ— æ•ˆã€‚
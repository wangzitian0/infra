# 0.check_now.md

## 1. What (Target)
BRN-008: IaC Initialization Patterns for PostgreSQL and Casdoor SSO.

## 2. Why (Value)
Implement declarative IaC initialization patterns to eliminate manual setup and `null_resource` hacks.

## 3. Where (Location)
- L1 Bootstrap: `1.bootstrap/5.platform_pg.tf` (initdb.scripts for DB creation)
- L2 Platform: `2.platform/5.casdoor.tf` (initData for org/user/app)
- Docs: `docs/ssot/secrets.md`, `docs/ssot/auth.md`

## 4. Who (Owner)
Infra Team / AI Assistant (Antigravity)

## 5. When (Timeline)
Current Phase: PR #139 Review

## 6. How (Action Plan)

### Blocking Actions
- [ ] **Merge PR #139**: IaC initialization patterns
  - [PR Link](https://github.com/wangzitian0/infra/pull/139)
  - Changes: initdb.scripts, initData, random_password, SSOT docs

### Completed
- [x] PostgreSQL: Added `initdb.scripts` for automatic database creation
- [x] Casdoor: Added `initData` for organization/user/app initialization
- [x] Removed `null_resource.casdoor_database` (replaced by initdb.scripts)
- [x] Fixed hardcoded password with `random_password` resource
- [x] Updated `docs/ssot/secrets.md` with 1Passwordâ†’GitHub mappings
- [x] Updated `docs/ssot/auth.md` with layered auth model
- [x] Synced `VAULT_POSTGRES_PASSWORD` to GitHub Secrets
- [x] Imported all secrets to 1Password as SSOT

## Verification
- [ ] All CI checks pass (GitGuardian, Atlantis plan/apply)
- [ ] Casdoor pod starts with correct database connection
- [ ] Admin login works (password from `terraform output -raw casdoor_admin_password`)
